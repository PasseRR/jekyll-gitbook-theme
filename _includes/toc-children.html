

{% assign posts = site.chapters | where_exp: "it", "it.pk == include.key" | where_exp: "it", "include.key == nil or it.category == include.category" | sort: "order" %}

{% for post in posts%}

    {% assign cls = "chapter" %}
    
    {% if page.url == post.url %}
        {% assign cls = cls | append: " active" %}
    {% endif %}

    {% assign children = [] %}
    {% if post.k %}
        {% assign children = site.chapters | where_exp: "it", "it.pk == post.k and it.category == post.category" %}
    {% endif %}
    <li class="{{cls}}" data-level="1.1" data-path="{{site.baseurl}}{{post.url}}">
        <a href="{{site.baseurl}}{{post.url}}" title="{{ post.title }}">
            {{ post.title | escape }}
        </a>
        {% if children.size > 0 %}
        <ul class="articles">
            {% assign l = include.level | plus: 1 %}
            {% include toc-children.html level=l key=post.k category=post.category %}
        </ul>
        {% endif%}
    </li>
{% endfor %}